<!DOCTYPE html>
<html>
<head>
  <title>Task Manager</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    body { padding: 30px; }
    .completed { text-decoration: line-through; color: green; }
  </style>
</head>
<body>

<h2 class="mb-4"> PHP Task Manager</h2>

<div class="mb-4">
  <input type="text" id="title" class="form-control mb-2" placeholder="Task Title">
  <textarea id="description" class="form-control mb-2" placeholder="Task Description"></textarea>
  <button onclick="addTask()" class="btn btn-primary">Add Task</button>
</div>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>#</th><th>Title</th><th>Description</th><th>Status</th><th>Actions</th>
    </tr>
  </thead>
  <tbody id="taskList"></tbody>
</table>

<script>
function fetchTasks() {
  fetch('tasks/list.php')
    .then(res => res.json())
    .then(data => {
      let html = '';
      data.forEach((task, index) => {
        html += `<tr>
          <td>${index + 1}</td>
          <td class="${task.is_completed == 1 ? 'completed' : ''}">${task.title}</td>
          <td>${task.description}</td>
          <td>${task.is_completed == 1 ? ' Done' : ' Pending'}</td>
          <td>
            <button class="btn btn-success btn-sm" onclick="completeTask(${task.id})">complete</button>
            <button class="btn btn-danger btn-sm" onclick="deleteTask(${task.id})">del</button>
          </td>
        </tr>`;
      });
      document.getElementById("taskList").innerHTML = html;
    });
}

function addTask() {
  const title = document.getElementById("title").value;
  const description = document.getElementById("description").value;

  fetch('tasks/add.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, description })
  }).then(() => {
    document.getElementById("title").value = "";
    document.getElementById("description").value = "";
    fetchTasks();
  });
}

function completeTask(id) {
  fetch('tasks/complete.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id })
  }).then(fetchTasks);
}

function deleteTask(id) {
  fetch('tasks/delete.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id })
  }).then(fetchTasks);
}

window.onload = fetchTasks;
</script>

</body>
</html>